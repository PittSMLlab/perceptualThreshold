%% Static protocol:
pS=[-250;100;25;-50;300;125;-75;-10;150;75;-200;-125;-25;0;-300;10;50;-100;-350;0;200;-150;250;350];
sT=[22.7219950407743;71.8679968267679;122.065994516015;173.413996025920;224.091995134950;273.719999939203;324.947996065021;375.670000165701;426.549999788404;477.708996087313;528.312000632286;578.844999521971;629.546001926064;679.892992973328;731.772001460195;781.585993990302;832.899998500943;883.257993310690;934.044994041324;984.847997501493;1036.44699342549;1086.55499964952;1137.80599907041;1185.73399297893];
eT=[47.3539978265762;97.4669929593801;147.932993620634;199.308001622558;249.031992629170;299.819999188185;350.938993692398;401.860996708274;452.616997808218;503.435993939638;553.886001929641;604.755993559957;655.289002507925;706.236996129155;756.805993616581;807.684001699090;858.911997824907;909.421993419528;959.116996452212;1011.56699359417;1061.84999383986;1112.45999895036;1161.85199618340;1211.59799471498];

%
figure
hold on
sst=round(sT/1.2); %Deriving stride numbers from data. Task was 25 strides to respond, 25 strides of tied, and repeat.
eet=round(eT/1.2);
v=zeros(1,max(eet)+10);
for i=1:length(sst)
   v(sst(i)-1:sst(i))=pS(i);
   v(sst(i)+1:eet(i))=nan;
end
p1=plot(v,'LineWidth',2,'DisplayName','Set speeds');
p2=plot(sst,pS,'o','MarkerFaceColor','red','MarkerEdgeColor','none','DisplayName','Probe start');
for i=1:length(pS)
   pp=patch([sst(i) eet(i) eet(i) sst(i)],400*[-1 -1 1 1],.6*ones(1,3),'EdgeColor','none','FaceAlpha',.6,'DisplayName','Task')
    uistack(pp,'bottom')
end
set(gca,'XLim',[0 max(eet)+10])
legend([p1 pp],'Location','North')
ylabel('Belt speed difference (mm/s)')
xlabel('Stride cycles')
title('Perceptual assessment protocol')

%% Dynamic protocol:
figure
%Baseline tasks:
sT=[28.0739977955818;64.7320065647364;101.410001143813;138.435006514192;175.628005340695;213.387999683619;250.296007096767;286.857999488711;324.030006676912;361.256006732583;398.885001987219;436.541999503970];
sT2=[28.0740078538656;64.4910000264645;101.557002961636;138.722009584308;175.505002588034;212.239001691341;249.361009150743;286.542008444667;323.457006365061;360.021000355482;397.291005402803;434.881004691124];
eT=[35.2900017052889;71.7830043286085;108.603001758456;145.867002010345;183.067997172475;220.697998255491;257.278005033731;294.224998354912;331.305998191237;368.706006556749;406.249003484845;443.780000880361];
eT2=[35.3040028363466;71.6510094702244;108.866005763412;145.890005305409;182.620001211762;219.467005133629;256.704008951783;293.756000697613;330.679005011916;367.257000133395;404.669008031487;442.244000360370];
pS=[100;-200;0;100;0;200;-100;200;0;-100;0;-200];
%pS2= %Same as ps
%Adaptation tasks:
eTa=[23.1290034949780;68.1360013782978;98.6390043050051;129.378004744649;160.598002374172;191.679004579782;223.335008695722;285.809000954032;351.590006053448;417.029009386897;482.002002373338;547.324007749557;612.900004908442;677.892008051276;744.300006330013;810.619008913636;877.767005190253;944.442000612617;990.694002807140];
sTa=[16.5570013225079;61.6310074925423;92.0080002397299;122.661002352834;153.940001875162;184.933999925852;216.565009206533;279.051000997424;344.903007522225;410.400006920099;475.451001897454;540.786002576351;606.329008564353;671.240002289414;737.492006644607;803.986003249884;870.964004471898;937.789009138942;983.979002013803];
pSa=[200;200;400;200;400;200;400;200;400;200;400;200;400;200;400;200;400;200;200];

%Post-adapt tasks:
sTp=[23.0650026351213;57.1810014545918;90.8819954842329;125.106000155210;159.535002708435;193.796997517347;264.033993333578;334.216000512242;404.964993149042;475.226993858814;546.163995936513;617.167000472546;687.448997050524];
eTp=[30.4349988698959;64.5129974931479;98.0799950659275;132.639000937343;166.798994690180;201.270996406674;271.602992713451;341.573997214437;412.529999390244;482.725997641683;553.573993965983;624.812996014953;694.693998992443];
pSp=[100;0;100;200;0;100;0;100;-100;0;100;-100;0];

%All together:
sst=round([sT; sT2+450; sTa+900; sTp+900+1050]/1.2);
eet=round([eT; eT2+450; eTa+900; eTp+900+1050]/1.2);
pps=[pS; pS; pSa; pSp];

v=[zeros(1,round(440/1.2)) nan(1,8) zeros(1,round(440/1.2)) nan(1,8) zeros(1,30) 500*ones(1,round(770)) zeros(1,50) nan(1,8) zeros(1,600)];
p1=plot(v,'LineWidth',2,'DisplayName','Set speeds');
hold on
p2=plot(sst,pps,'o','MarkerFaceColor','red','MarkerEdgeColor','none','DisplayName','Probe start');
for i=1:length(pps)
   pp=patch([sst(i) eet(i) eet(i) sst(i)],500*[-1 -1 1 1],.6*ones(1,3),'EdgeColor','none','FaceAlpha',.6,'DisplayName','Task')
    uistack(pp,'bottom')
end
set(gca,'XLim',[0 max(eet)+10],'YLim',[-300 500])
legend([p1 pp],'Location','South')
ylabel('Belt speed difference (mm/s)')
xlabel('Stride cycles')
title('Perceptual assessment protocol')
